---
title: "SI-M1-TD4"
author: "Guillaume Metzler"
date: "10/25/2021"
output: pdf_document
---

## Exercice 1

Commençons par charger les données 

```{r}
load('~/Desktop/tempsTV.Rdata')
data$sexe[data$sexe==1]="homme" 
data$sexe[data$sexe==2]="femme"
```

Dans ce premier exercice, on se demande si les variables "periode" et "sexe" qui sont deux variables qualitatives ont une influence sur la variable "temps" (variable quantitative).

On va donc poser les hypothèses suivantes :

\begin{itemize}
\item[•] $H_0$ : la variable "temps" est indépendante des deux autres facteurs v.s.
\item[•] $H_1$ : la variable "temps" est dépendante d'au moins un des autres facteurs.
\end{itemize}

La formulation gagnerait à être plus précise car la variable temps peu dépendre d'un seul des deux facteurs ou encore des deux facteurs.\

Dans tous les cas, etant donné que nous devons étudier l'influence de deux facteurs sur une variable quantitative, nous devons effectuer une Analyse de Variance (ANOVA).\

Regardons graphiquement si le sexe a une influence sur la variable temps

```{r}
par(mfrow=c(1,2)) 
boxplot(temps~sexe,data=data) 
boxplot(temps~periode,data=data)
```

Graphiquement, il semblerait que seule la variable "periode" ait une infleucne sur la variable temps. Il faudra donc vérifier cela à l'aide de notre ANOVA.\

\paragraph{Remarque} L'Analyse de Variance consiste à une étude de la variance de notre jeu de données afin de déterminer la part de la variance expliquée par les différents facteurs. Par exemple, pour une ANOVA à un facteur, la variance totale de notre jeu de données $V_T$ peut s'exprimer à partir de la variance expliquée par le facteur $A, V_A$ et une variance résiduelle $V_R$, {\it i.e.} non expliquée par le facteur $A$ :

\[V_T = V_A + V_R\]

Pour une ANOVA à deux facteurs (disons $A$ et $B$) il faut donc regarder la part de variance expliquée par le facteur $A$ et la part de variance expliquée par le facteur $B$. Si on reprend notre formule précédente, nous pouvons alors décomposer notre variance résiduelle $V_R$ en $V_R = V_B + \tilde{V_R}$. Dit autrement, une part de la variance non expliquée précédemment l'est en fait par le facteur $B$.

\[V_T = V_A + V_B + \tilde{V_R}.\]

Or l'importance d'un facteur est estimée en fonction du rapport entre la variance expliquée par ce facteur et la variance résiduelle du modèle. Cela suggère bien qu'il est important d'effectuer une ANOVA à deux facteurs et non deux ANOVA à un facteur.

Regardons cela avec notre test 

```{r}
res=aov(temps~sexe+periode,data=data) 
print(anova(res))
```

La variable "periode" a donc une importance significative sur la variable "temps" mais ce n'est pas le cas de la variable "sexe".\

Regardons maintenant ce qui se passe chez les hommes et chez les femmes 

```{r}
par(mfrow=c(1,2)) 
datah=data[data$sexe=="homme",] 
boxplot(temps~periode,data=datah,main='homme') 
dataf=data[data$sexe=="femme",] 
boxplot(temps~periode,data=dataf,main='femme')
```

Remarquons que le comportement n'est pas du tout le même chez les hommes et chez les femmes. Le genre semble donc avoir un effet sur le lien entre les variables "temps" et "période". C'est ce que l'on appelle un {\bf effet d'intéraction entre les deux facteurs} de notre ANOVA. Ainsi, dans une ANOVA à plusieurs facteurs, il est donc important de prendre en compte les effets d'intéractions entre les différents facteurs. Ce que l'on fait de la façon suivante : 

```{r}
res=aov(temps~sexe+periode+sexe*periode,data=data) 
print(anova(res))
```
On constate que cette interaction est en effet significative.

Il reste tout de même une chose à vérifier ... avons-nous le droit de faire cette ANOVA ? Est-ce que toutes les conditions sont réunies ?\

\begin{itemize}
\item[•] Ici, en ANOVA à 2 facteurs, il doit être grand ou gaussien pour chaque croisement de niveaux des 2 facteurs (période A - homme, période A - femme, . . . ). Donc clairement ici les échantillons ne sont pas grands. Il faut vérifier la normalité. Mais c’est impossible à faire pour chaque croisement de niveaux des facteurs, les données ne sont pas assez nombreuses et le test de Shapiro alors pas assez puissant. On se contente donc généralement en ANOVA à 2 facteurs de vérifier la normalité des résidus de
lVA\item[•] des variances homogènes pour chaque facteur.
\end{itemize}

Commençons par regarder la normalité des résidus.

```{r}
qqnorm(res$residuals)
qqline(res$residuals)
shapiro.test(res$residuals)
```

On peut accepter cette hypothèse de normalité des données car la p-value est supérieure au risque de première espèce $\alpha=0.05$.

Quant à l’homogénéité des variances, on peut la tester avec un test de Bartlett, facteur par facteur.

```{r}
bartlett.test(temps~periode,data=data)
bartlett.test(temps~sexe,data=data)
```

L’homogénéite des variances n’est pas respectée ici. En effet, la p-value est ici bien inférieure à $0.05$ pour les deux facteurs. 
Néanmoins l’ANOVA reste assez robuste à la non homogénéite des variances lorsque les effectifs ne sont pas trop différents d’une modalité à l’autre, ce qui est le cas ici. 
De plus, il n’existe pas d’alternative non paramétrique à l’ANOVA à 2 facteurs. (Pour l’ANOVA à 1 facteur, on aurait pu passer à un test de Kruskall).\

On peut regarder le graphique ci-dessous qui nous montre comment évolue les différentes moyennes en fonction des différents facteurs.

```{r}

interaction.plot(data$sexe,data$periode,data$temps)
```

On peut aussi aller plus en détail pour faire des tests deux à deux entre modalité, au niveau des périodes. Pour contrecarer les problématiques de multiplicité des tests, on utilise des corrections comme celle de Bonferroni:

```{r}
pairwise.t.test(data$temps,data$periode,p.adjust.method = "bonferroni")
```

Ici on remarque par exemple que les périodes $B$ et $C$ sont significativement différentes alors que $A$ et $C$ ne le sont pas.

## Exercice 2 

On se propose de travailler à nouveau sur le fichier GermanCredit afin de répondre à plusieurs questions. Cet exercice est très proche de ce qui vous attendra à l'examen. 

### Question 1

On cherche à savoir si le sexe (variable quali) à une influence sur le montant emprunté (variable quanti) et plus précisément si les femmes empruntent un montant plus important que les hommes. On formule alors les hypothèses suivantes :

\begin{itemize}
\item[•] $H_0 :$ 
\item[•] $H_1 :$ 
\end{itemize}

### Question 2

On cherche à savoir si l'emploi (variable quali) et le sexe (variable quali) ont une influence sur la durée de l'emprunt (variable quanti). On formule alors les hypothèses suivantes :

\begin{itemize}
\item[•] $H_0 :$ 
\item[•] $H_1 :$ 
\end{itemize}

### Question 3

On se propose ensuite d'étudier si les variables "montant du crédit" (variable quanti) et "durée de l'emprunt" (variable quanti) sont des variables gaussiennes. On formule alors les hypothèses suivantes :

\begin{itemize}
\item[•] $H_0 :$ 
\item[•] $H_1 :$ 
\end{itemize}

### Question 4

On cherche à savoir si le montant du crédit (variable quanti) est lié au but du crédit (variable quali). On formule alors les hypothèses suivantes :

\begin{itemize}
\item[•] $H_0 :$ 
\item[•] $H_1 :$ 
\end{itemize}

### Question 5

On cherche à savoir si le montant emprunté est différent selon notre situation personnelle en terme de logement (propriétaire, locataire, ...). On formule alors les hypothèses suivantes :

\begin{itemize}
\item[•] $H_0 :$ 
\item[•] $H_1 :$ 
\end{itemize}


### Question 6

Enfin, on souhaite savoir si le montant du crédit est lié à la durée de ce dernier. On formule alors les hypothèses suivantes :

\begin{itemize}
\item[•] $H_0 :$ 
\item[•] $H_1 :$ 
\end{itemize}


